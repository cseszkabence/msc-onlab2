<!-- <p-table [value]="dataSource" class="p-datatable-sm demo-table">
  <ng-template pTemplate="header">
    <tr>
      <th>Component</th>
      <th>Chosen product</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-element>
    <tr>
      <td>{{ element.name }}</td>
      <td>
        <ng-container *ngIf="element.productChosen">
          <div class="comp-info-label">Chosen product: {{element.chosenProduct.name}}</div>
          <div class="comp-info-label">{{element.chosenProduct.chipset}}</div>
          <div class="comp-info-label">Price: {{element.chosenProduct.price | currency}}</div>
          <p-button label="Remove" (click)="removeComponent(element)"></p-button>
        </ng-container>

        <ng-container *ngIf="!element.productBrowserActive && !element.productChosen">
          <p-button label="+ Choose" class="comp-add-btn" (click)="toggleBrowser(element.name)"></p-button>
        </ng-container>

        <ng-container *ngIf="element.productBrowserActive">
          <div @slideDownUp>
            <div>This is the product browser</div>
            <p-listbox [options]="element.browsableProducts" optionLabel="name" [style]="{ width: '100%' }">
              <ng-template let-product pTemplate="item">
                <div class="p-d-flex p-ai-center">
                  <div class="comp-info-label">{{ product.name }}</div>
                  <div class="comp-info-label">{{ product.chipset }}</div>
                  <div class="comp-info-label">Cores: {{ product.coreCount }}</div>
                  <div class="comp-info-label">Price: {{ product.price | currency }}</div>
                  <p-button icon="pi pi-plus" class="comp-add-btn"
                    (click)="chooseComponent(element, product)"></p-button>
                </div>
              </ng-template>
            </p-listbox>
          </div>
        </ng-container>
      </td>
    </tr>
  </ng-template>
</p-table> -->

<h2>Your Current Build</h2>

<!-- wait for build to load -->
<ng-container *ngIf="build$ | async as build">
  <p-table [value]="parts" [responsive]="true">
    <ng-template pTemplate="header">
      <tr>
        <th>Component</th>
        <th>Selected Part</th>
        <th>Price</th>
        <th>Action</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-part>
      <tr>
        <!-- label -->
        <td>{{ part.label }}</td>

        <!-- selection or placeholder -->
        <td>
          {{ build[part.key]?.name || '— not chosen —' }}
        </td>

        <!-- price if exists -->
        <td>
          {{ build[part.key]?.price ? (build[part.key]?.price | currency:'EUR') : '—' }}
        </td>

        <!-- choose button -->
        <td>
          <!-- If a part exists -> show Remove; otherwise -> Choose -->
          <ng-container *ngIf="build[part.key]; else chooseTpl">
            <button pButton type="button" icon="pi pi-times" label="Remove" class="p-button-danger p-button-text"
              (click)="removePart(part)"></button>
          </ng-container>

          <ng-template #chooseTpl>
            <button pButton type="button" icon="pi pi-search" label="Choose" (click)="choose(part)"></button>
          </ng-template>
        </td>
      </tr>
    </ng-template>
  </p-table>
  <p-button pButton label="Save Build" icon="pi pi-save" class="p-mt-3" (click)="onSaveClick()">
  </p-button>
  <p-button pButton type="button" label="Load Configuration" icon="pi pi-folder-open" class="p-ml-2"
    (click)="openLoadDialog()" w>
  </p-button>
  <p-button pButton type="button" icon="pi pi-shopping-cart" label="Add All to Cart" class="p-ml-2"
    (click)="addAllToCart()" [disabled]="!(
    build.processor ||
    build.motherboard ||
    build.videocard ||
    build.memory ||
    build.powersupply ||
    build.pccase ||
    build.harddrive ||
    build.cpucooler
  )"></p-button>

</ng-container>





<p-dialog header="Name Your Build" [(visible)]="displaySaveDialog" [modal]="true" [closable]="false"
  [style]="{ width: '320px' }">
  <div class="p-fluid">
    <div class="p-field">
      <label for="cfgName">Build Name</label>
      <input id="cfgName" type="text" pInputText [(ngModel)]="configName" placeholder="e.g. My Gaming Rig" />
    </div>
  </div>
  <ng-template pTemplate="footer">
    <p-button pButton label="Cancel" icon="pi pi-times" (click)="displaySaveDialog = false">
    </p-button>
    <p-button pButton label="Save" icon="pi pi-check" [disabled]="!configName" (click)="saveConfig()">
    </p-button>
  </ng-template>
</p-dialog>

<p-dialog header="Load a saved configuration" [(visible)]="displayLoadDialog" [modal]="true" [closable]="false"
  [style]="{ width: '500px' }" (onHide)="selectedConfigId = undefined">
  <ng-container *ngIf="!loadingConfigs; else loadingTpl">
    <p-listbox [options]="configs" optionLabel="name" [optionValue]="'id'" [(ngModel)]="selectedConfigId"
      [multiple]="false" [filter]="true" [listStyle]="{ 'max-height': '260px' }">
      <ng-template let-c pTemplate="item">
        <div class="flex justify-between w-full">
          <div class="font-medium">{{ c.name }}</div>
          <small class="opacity-70">#{{ c.id }}</small>
        </div>
      </ng-template>
    </p-listbox>

    <div class="flex justify-end gap-2 mt-3">
      <button pButton label="Cancel" class="p-button-text" (click)="displayLoadDialog=false"></button>
      <button pButton label="Load" icon="pi pi-check" [disabled]="!selectedConfigId"
        (click)="onLoadSelected()"></button>
    </div>
  </ng-container>

  <ng-template #loadingTpl>
    <div class="flex justify-center p-4">
      <p-progressSpinner></p-progressSpinner>
    </div>
  </ng-template>
</p-dialog>


<div class="comp-totalprice-label">TOTAL: {{ totalPrice | currency }}</div>
<p-button label="CALCULATE" class="comp-add-btn" (click)="totalPriceCalculator()"></p-button>